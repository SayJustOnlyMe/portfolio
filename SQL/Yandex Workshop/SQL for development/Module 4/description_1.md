## Первая часть проекта — оптимизация базы данных
Для выполнения заданий первой части требуется развернуть предложенный дамп базы данных.

В заданиях ниже описаны ситуации, когда база данных работает недостаточно быстро. 
Требуется проанализировать эти ситуации, предложить наиболее удачный, на свой взгляд, план решения проблемы и реализовать его. 

В ответе указать:
- Причину — почему проблема возникла, описать ход рассуждений;
- План решения — что предлагается сделать, чтобы решить проблему;
- Скрипты — если они нужны для реализации плана;

### Задание 1
 * Клиенты сервиса начали замечать, что после нажатия на кнопку **Оформить заказ** система на какое-то время подвисает. 
 Вот команда для вставки данных в таблицу *orders*, которая хранит общую информацию о заказах:

```
INSERT INTO orders(order_id, order_dt, user_id, device_type, city_id, total_cost, discount,final_cost)
SELECT MAX(order_id) + 1, current_timestamp, '329551a1-215d-43e6-baee-322f2467272d', 'Mobile', 1, 1000.00, null, 1000.00
FROM orders;
```

- [ ] Проанализировать возможные причины медленной вставки новой строки в таблицу *orders*.

### Задание 2
 * Клиенты сервиса в свой день рождения получают скидку.
 Расчёт скидки и отправка клиентам промокодов происходит на стороне сервера приложения.
 Список клиентов возвращается из БД в приложение таким запросом:

```
SELECT user_id::text::uuid, first_name::text, last_name::text, 
    city_id::bigint, gender::text
FROM users
WHERE city_id::integer = 4
    AND date_part('day', to_date(birth_date::text, 'yyyy-mm-dd')) 
        = date_part('day', to_date('31-12-2023', 'dd-mm-yyyy'))
    AND date_part('month', to_date(birth_date::text, 'yyyy-mm-dd')) 
        = date_part('month', to_date('31-12-2023', 'dd-mm-yyyy'))
```
Каждый раз список именинников формируется и возвращается недостаточно быстро. 
- [ ] Оптимизировать этот процесс.

### Задание 3
Пользователи жалуются, что оплата при оформлении заказа проходит долго.
Разработчик сервера приложения проанализировал ситуацию и заключил, что оплата «висит» из-за того, что выполнение процедуры *add_payment* требует довольно много времени по меркам БД. 
- [ ] Найти в базе данных эту процедуру и подумать, как можно ускорить её работу.

### Задание 4
Все действия пользователей в системе логируются и записываются в таблицу *user_logs*. Потом эти данные используются для анализа — как правило, анализируются данные за текущий квартал.
Время записи данных в эту таблицу сильно увеличилось, а это тормозит практически все действия пользователя. 
- [ ] Придумать, как можно ускорить запись.

### Задание 5
Маркетологи сервиса регулярно анализируют предпочтения различных возрастных групп. Для этого они формируют отчёт:
| day  | age | spicy  | fish | meat |
| ---- | ---- | ---- | ---- | ---- |
|    |  0–20  |    |    |    |
|    |  20–30  |    |    |    |
|    |  30–40  |    |    |    |
|    |  40–100  |    |    |    |
	
В столбцах *spicy*, *fish* и *meat* отображается, какой *% блюд*, заказанных каждой категорией пользователей, содержал эти признаки.
В возрастных интервалах верхний предел входит в интервал, а нижний — нет.
Также по правилам построения отчётов в них не включается текущий день.
Администратор БД заметил, что регулярные похожие запросы от разных маркетологов нагружают базу, и в результате увеличивается время работы приложения.
- [ ] Подумать с точки зрения производительности, как можно оптимально собирать и хранить данные для такого отчёта.

 ### [Пример моего решения данной задачи](https://github.com/SayJustOnlyMe/portfolio/blob/main/SQL/Yandex%20Workshop/SQL%20for%20development/Module%204/queries_1.sql)
