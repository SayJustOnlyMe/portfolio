## II проект

Для выполнения заданий потребуется развернуть предложенный дамп базы данных.

- [ ] Во втором проекте требуется построить дополнительные таблицы с продвинутыми типами данных и выполнить семь заданий: поработать с геоданными, создать представления и написать несколько аналитических запросов, используя оконные функции и подзапросы.

## Этап 1. Создание дополнительных таблиц
Требуется создать дополнительные таблицы с продвинутыми типами данных. 

Пошаговая инструкция:
- Шаг 1. Cоздать *enum cafe.restaurant_type* с типом заведения *coffee_shop*, *restaurant*, *bar*, *pizzeria*. Использовать этот тип данных при создании таблицы *restaurants*.
- Шаг 2. Создать таблицу *cafe.restaurants* с информацией о ресторанах. В качестве первичного ключа использовать случайно сгенерированный *uuid*. Таблица хранит: *restaurant_uuid*, *название заведения*, *его локацию в формате PostGIS*, *тип кафе* и *меню*.
- Шаг 3. Создать таблицу *cafe.managers* с информацией о менеджерах. В качестве первичного ключа использовать случайно сгенерированный *uuid*. Таблица хранит: *manager_uuid*, *имя менеджера* и *его телефон*.
- Шаг 4. Создать таблицу *cafe.restaurant_manager_work_dates*. Таблица хранит: *restaurant_uuid*, *manager_uuid*, *дату начала работы в ресторане* и *дату окончания работы в ресторане*. Задать составной первичный ключ из двух полей: *restaurant_uuid* и *manager_uuid*. Работа менеджера в ресторане от даты начала до даты окончания — единый период, без перерывов.
- Шаг 5. Создать таблицу *cafe.sales* со столбцами: *date*, *restaurant_uuid*, *avg_check*. Задать составной первичный ключ из *даты* и *uuid ресторана*.

## Этап 2. Создание представлений и написание аналитических запросов

Дополнительные таблицы готовы, теперь — пора представлений и запросов.

### Задание 1
Чтобы выдать премию менеджерам, нужно понять, у каких заведений самый высокий средний чек. 
- [ ] Требуется создать представление, которое покажет топ-3 заведений внутри каждого типа заведения по среднему чеку за все даты. 

Столбец со средним чеком округлить до второго знака после запятой.
Формат итоговой таблицы:

| Название заведения  | Тип заведения | Средний чек  |
| ---- | ---- | ---- |
|  Заведение 1  |  Бар  |  1500  |
|  Заведение 2  |  Бар  |  1400  |
|  Заведение 3  |  Бар  |  1300  |
|  Заведение 4  |  Пиццерия  |  1700  |
|  Заведение 5  |  Пиццерия  |  1500  |
|  Заведение 6  |  Пиццерия  |  1300  |

### Задание 2
- [ ] Требуется создать материализованное представление, которое покажет, как изменяется средний чек для каждого заведения от года к году за все года за исключением 2023 года.

Все столбцы со средним чеком округлить до второго знака после запятой.
Формат материализованного представления:

| Год  | Название заведения | Тип заведения  | Средний чек в этом году | Средний чек в предыдущем году | Изменение ср. чека в % |
| ---- | ---- | ---- | ---- | ---- | ---- |
|  2017  |  Заведение 1  |  Кофейня  |  655.25  |  [null]  |  [null]  |
|  2018  |  Заведение 1  |  Кофейня  |  656.22  |  655.25  |  0.15  |
|  2022  |  Заведение 1  |  Кофейня  |  …  |  …  |  …  |
|  2017  |  Заведение 2  |  Пиццерия  |  688.22  |  [null]  |  [null]  |
|  2018  |  Заведение 2  |  Пиццерия  |  655.12  |  688.22  |  -5.05  |

### Задание 3
- [ ] Требуется найти топ-3 заведения, где чаще всего менялся менеджер за весь период.

Формат итоговой таблицы:

| Название заведения  | Сколько раз менялся менеджер |
| ------------- | --- |
|  Заведение 1  |  6  |
|  Заведение 2  |  5  |
|  Заведение 3  |  5  |

### Задание 4
- [ ] Требуется найти пиццерию с самым большим количеством пицц в меню. Если таких пиццерий несколько, вывести все.

Формат итоговой таблицы:

| Название заведения  | Количество пицц в меню |
| ------------- | ---- |
|  Заведение 1  |  10  |
|  Заведение 2  |  10  |
|  Заведение 3  |  10  |

### Задание 5
- [ ] Требуется найти самую дорогую пиццу для каждой пиццерии.

Формат итоговой таблицы:

| Название заведения  | Тип блюда | Название пиццы  | Цена |
| ---- | ---- | ---- | ---- |
|  Заведение 1  |  Пицца  |  Маргарита  |  689  |
|  Заведение 2  |  Пицца  |  Диавола  |  566  |
|  Заведение 3  |  Пицца  |  Четыре сезона  |  455  |

### Задание 6
- [ ] Требуется найти два самых близких друг к другу заведения одного типа.

Формат итоговой таблицы:

| Название заведения 1  | Название заведения 2 | Тип заведения  | Расстояние |
| ---- | ---- | ---- | ---- |
|  Мир Эспрессо  |  Кофеинозависимые  |  Кофейня  |  63.67510564  |

### Задание 7
- [ ] Требуется найти район с самым большим количеством заведений и район с самым маленьким количеством заведений. 

Первой строчкой выведите район с самым большим количеством заведений, второй — с самым маленьким. 
Формат итоговой таблицы:

| Название района  | Количество заведений |
| ------------- | ---- |
|  Район с самым большим количеством заведений  |  15  |
|  Район с самым маленьким количеством заведений  |  2  |

 ### [Пример моего решения данной задачи](https://github.com/SayJustOnlyMe/portfolio/blob/main/SQL/Yandex%20Workshop/SQL%20for%20development/Module%202/queries.sql)
